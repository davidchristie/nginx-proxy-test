name: Test

on: [push]

jobs:
  test:
    name: Test
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-16.04, ubuntu-latest]
    steps:
      - uses: actions/checkout@v1
      - name: Start the services
        run: docker-compose up -d
      - name: List docker networks
        run: docker network ls
      - name: Inspect default docker network
        run: docker network inspect nginx-proxy-test_default
      - name: Print generated nginx-proxy configuration
        run: docker-compose exec -T nginx-proxy cat /etc/nginx/conf.d/default.conf
      - name: Test http://whoami.local can be resolved
        run: docker run --network container:nginx-proxy curlimages/curl http://whoami.local
      - name: Print docker service logs
        run: docker-compose logs
